@page "/admin/logs"
@layout AdminLayout
@attribute [Authorize]
@inherits AdminLogsBase

<div class="card shadow rounded-3 overflow-hidden border mb-4" style="background:#fff;">
    <div class="card-body">
        <h4 class="card-title mb-3 fw-bold">Fichiers de log</h4>
        <select class="form-select mb-3" style="max-width:280px;" @onchange="OnLogFileChanged">
            @foreach (var file in LogFiles)
            {
                <option value="@file" selected="@(file==SelectedLogFile)">@file</option>
            }
        </select>
        <div class="row g-2 mb-3" style="max-width:560px;">
            <div class="col">
                <label class="form-label">Début</label>
                <input type="datetime-local" class="form-control" @bind="FilterStart" />
            </div>
            <div class="col">
                <label class="form-label">Fin</label>
                <input type="datetime-local" class="form-control" @bind="FilterEnd" />
            </div>
            <div class="col-auto">
                <button class="btn btn-outline-secondary" @onclick="ApplyFilterAsync">Filtrer</button>
            </div>
        </div>
        <pre class="border p-3" style="max-height:500px; overflow:auto; white-space:pre-wrap;">@LogContent</pre>
    </div>
</div>

<div class="card shadow rounded-3 overflow-hidden border" style="background:#fff;">
    <div class="card-body">
        <h4 class="card-title mb-3 fw-bold">Base de données</h4>
        <div class="d-flex flex-wrap align-items-end gap-2">
            <button class="btn btn-outline-primary" @onclick="DownloadDatabaseAsync">
                <i class="bi bi-download me-1"></i>Télécharger
            </button>
            <InputFile id="dbUpload" OnChange="OnDbSelected" style="display:none;" />
            <button class="btn btn-danger" @onclick="TriggerDbUpload" disabled="@IsBusy">
                <i class="bi bi-upload me-1"></i>Charger...
                @if (IsBusy)
                {
                    <span class="spinner-border spinner-border-sm ms-2"></span>
                }
            </button>
            @if (LastBackupDate is DateTime d)
            {
                <span class="text-muted small align-self-center">Dernier backup&nbsp;: @d.ToString("dd/MM/yyyy HH:mm")</span>
            }
        </div>
    </div>
</div>
